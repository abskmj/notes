<!doctype html><html lang=en><head><title>Track API usage with Google Analytics :: Notes</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Google analytics is a popular tool to track your website usage."><meta name=keywords content><meta name=robots content="noodp"><link rel=canonical href=https://abskmj.github.io/notes/posts/tutorials/track-api-usage-google-analytics/><link rel=stylesheet href=https://abskmj.github.io/notes/styles.css><link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/29548356?s=32&amp;v=4"><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Track API usage with Google Analytics"><meta property="og:description" content="Google analytics is a popular tool to track your website usage."><meta property="og:url" content="https://abskmj.github.io/notes/posts/tutorials/track-api-usage-google-analytics/"><meta property="og:site_name" content="Notes"><meta property="og:image" content="https://avatars.githubusercontent.com/u/29548356?s=32&amp;v=4"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:published_time" content="2017-11-15 18:02:07 +0530 +0530"><link rel=apple-touch-icon sizes=180x180 href=/notes/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/notes/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/notes/favicon-16x16.png><link rel=manifest href=/notes/site.webmanifest><meta name=google-site-verification content="f4QUPyqBnCYP57-SME_dv0q-Di8xwBAOMIhlBGeVWJY"><script async src="https://www.googletagmanager.com/gtag/js?id=G-CMVNGMLVMF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CMVNGMLVMF")</script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "aa73cbf1591c45448ff0b2735f97bb74"}'></script></head><body class=green><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/notes><div class=logo>Notes</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://discordapp.com/users/220585271983472650>Discord</a></li><li><a href=mailto:contact.abskmj@gmail.com>Email</a></li><li><a href=https://github.com/abskmj>Github</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=https://discordapp.com/users/220585271983472650>Discord</a></li><li><a href=mailto:contact.abskmj@gmail.com>Email</a></li><li><a href=https://github.com/abskmj>Github</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://abskmj.github.io/notes/posts/tutorials/track-api-usage-google-analytics/>Track API usage with Google Analytics</a></h1><div class=post-meta><time class=post-date>2017-11-15</time></div><span class=post-tags>#<a href=https://abskmj.github.io/notes/tags/google-analytics/>Google Analytics</a>&nbsp;
#<a href=https://abskmj.github.io/notes/tags/nodejs/>NodeJS</a>&nbsp;
#<a href=https://abskmj.github.io/notes/tags/npm/>NPM</a>&nbsp;
#<a href=https://abskmj.github.io/notes/tags/tutorial/>Tutorial</a>&nbsp;</span><div class=post-content><div><p>Google analytics is a popular tool to track your website usage. Usage of server APIs can also be tracked with this tool. Measurement Protocol APIs can be used to post the usage data to Google Analytics.</p><blockquote><p><a href=https://developers.google.com/analytics/devguides/collection/protocol/>Measurement Protocol</a> can be used to track user interactions in any environment of internet connected devices. It allows developers to collect user-interaction in form of event or hit.</p></blockquote><h1 id=api-hit>API Hit<a href=#api-hit class=hanchor arialabel=Anchor>&#8983;</a></h1><p>Each invocation of an API can be tracked as a unique event. Optionally, the response time in millisecond can be included as well.</p><pre tabindex=0><code>&amp;t=event            // Event hit type
&amp;ec=api             // Event category: api
&amp;ea=invoke          // Event action: invoke
&amp;el=registration    // Event label: name of the API
&amp;ev=300             // Event value: (optional) response time in milliseconds
</code></pre><h2 id=user-session>User Session<a href=#user-session class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Multiple APIs can be invoked by multiple users over multiple sessions. Multiple sessions is automatically handled by Google Analytics. Multiple users can be handled by setting <code>cid</code> field appropriately. Each unique value set will correspond to a new user.</p><pre tabindex=0><code>&amp;cid=555    // Anonymous Client ID.
</code></pre><p>User&rsquo;s IP can be used to set this field uniquely.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>cid</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>hash</span>(<span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>headers</span>[<span style=color:#e6db74>&#39;x-forwarded-for&#39;</span>] <span style=color:#f92672>||</span> <span style=color:#a6e22e>request</span>.<span style=color:#a6e22e>connection</span>.<span style=color:#a6e22e>remoteAddress</span>);
</span></span></code></pre></div><ul><li><a href=https://en.wikipedia.org/wiki/X-Forwarded-For><code>x-forwarded-for</code></a> header is generally used by proxies to pass originating client&rsquo;s IP.</li><li>IP value should be hashed to avoid collecting sensitive user or client information.</li></ul><h2 id=user-analytics>User Analytics<a href=#user-analytics class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Most of this data is captured by processing user&rsquo;s IP address and browser&rsquo;s <a href=https://en.wikipedia.org/wiki/User_agent>user agent</a>. In this case, user&rsquo;s IP and UA is not passed to Google Analytics rather the server&rsquo;s IP is passed. All the analytics will have details of the servers only.</p><p>To fix this, <code>uip</code> & <code>ua</code> fields can be used to set user information.</p><pre tabindex=0><code>&amp;uip=1.2.3.4     // IP address override.
&amp;ua=Opera/9.80   // User agent override.
</code></pre><blockquote><p>I have published a npm module which allows such overrides <a href=https://www.npmjs.com/package/@abskmj/google-analytics-tracker>@abskmj/google-analytics-tracker</a>.</p></blockquote><h2 id=sample-request>Sample Request<a href=#sample-request class=hanchor arialabel=Anchor>&#8983;</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// nodejs
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>request</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;request&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>request</span>({
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>baseUrl</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://www.google-analytics.com&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>uri</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/collect&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>body</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;v=1&amp;tid=UA-XXXXXXXX-X&amp;cid=XXXXXXX&amp;t=event&amp;ec=api&amp;ea=invoke&amp;el=registration&amp;ev=300&amp;uip=1.2.3.4&amp;ua=Opera/9.80&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>method</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;POST&#39;</span>
</span></span><span style=display:flex><span>}, <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>error</span>, <span style=color:#a6e22e>response</span>, <span style=color:#a6e22e>body</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>error</span>){
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>body</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://abskmj.github.io/notes/posts/solutions/hackerearth/data-structures/trees/binary-and-nary-trees/mirror-image-2/><span class=button__icon>←</span>
<span class=button__text>HackerEarth - Mirror Image</span>
</a></span><span class="button next"><a href=https://abskmj.github.io/notes/posts/solutions/hackerrank/algorithms/greedy/largest-permutation/><span class=button__text>HackerRank - Largest Permutation</span>
<span class=button__icon>→</span></a></span></div></div><div id=sponsor class=pagination style=display:none><div class=pagination__title><span class=pagination__title-h>Sponsor</span><hr></div><div class=pagination__buttons><a id=sponsor-link href=https://wise.prf.hn/l/rwNWqOE target=_blank><span id=sponsor-text style=white-space:normal>Wise is a cheaper, faster way to send money abroad. Join over 10 million people who get the real exchange rate
with Wise. They’re up to 8x cheaper than banks.</span></a></div></div><script src=//ace-ally.onrender.com/next.js></script><div class=pagination><div class=pagination__title><span class=pagination__title-h>Discuss Post</span><hr></div><div class=pagination__buttons><span class="button next"><a href="https://github.com/abskmj/notes/discussions/new?category=general&label=comment&title=Track%20API%20usage%20with%20Google%20Analytics"><span class=button__text>Comment</span>
<span class=button__icon>→</span>
</a></span><span class="button next"><a href=https://github.com/abskmj/notes/tree/master/content/posts/tutorials/track-api-usage-google-analytics.md><span class=button__text>Edit at Github</span>
<span class=button__icon>→</span></a></span></div></div></article></div><footer class=footer><div class=footer__inner><div class="copyright copyright--user"><span>&copy; abskmj</span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/notes/bundle.min.js></script></div></body></html>